title	author	date	output
MATH 154 - HW5
your name here
due: Wednesday, October 4, 2017
pdf_document	html_document
default
default
knitr::opts_chunk$set(echo = TRUE, message=FALSE, warning=FALSE, cache=TRUE, 
                      fig.width=7, fig.height=3, fig.align = "center")
summary

In this assignment you will expand what you know about the standard logic of hypothesis testing from using calculus and limit theorems to using computational techniques. That is, instead of focusing on the asymptotic distribution of a statistic (to get its sampling distribution), the sampling distribution of the statistic will be formed from repeated permutations of the data under the null hypothesis.

requisites

In the homework, we will use two datasets which are available in R packages.

This is survey data collected by the US National Center for Health Statistics (NCHS) which has conducted a series of health and nutrition surveys since the early 1960's. Since 1999 approximately 5,000 individuals of all ages are interviewed in their homes every year and complete the health examination component of the survey. The health examination is conducted in a mobile examination centre (MEC). [Data from 2009-2012 with adjusted weighting.]

Boring et al. (2016) reanalyze data from MacNell et al. (2014). Students were randomized to 4 online sections of a course. In two sections, the instructors swapped identities. Was the instructor who identified as female rated lower on average?

assignment

#library(devtools)
#devtools::install_github("statlab/permuter")
require(permuter)
data(macnell)  # let me know if the data don't install, and I can send them to you
require(NHANES)
require(dplyr)
data(NHANES)
Consider the at least 4 course evaluation variables in the macnell data on course evaluations.

a. For each of the variables you have chosen, perform a two-sided permutation test to determine whether or not to reject the null hypothesis that gender perception does not impact student evaluation.

b. Use Fisher's combining rule to determine whether or not all of the null hypotheses from part (a) are true. https://en.wikipedia.org/wiki/Fisher%27s_method

c. Given your results from (a) and (b) comment on what the data say (or don't say) about bias from perceived gender. You might want to speak about sample size, power, and effect size.

From the NHANES data... Consider the two group scenario: Poverty (a ratio of family income to poverty guidelines. Smaller numbers indicate more poverty.) as broken down by Smoking (SmokeNow variable). The test of difference in shift can be modeled by a difference in means or by a difference in medians. Question: which test is more powerful? To answer the question, follow the steps below.

Recall that power is the probability of rejecting the null hypothesis when in fact the alternative hypothesis is true. To estimate power (for different statistics), we will simulate data (based on NHANES) where we know the alternative hypothesis to be true. Note here that we won't actually use the original labels (and their significance) for the analysis.

Step 1 Randomly assign the Poverty variable to the two smoking groups. [Answer this question: does the dataset at hand come from a null population or an alternative population? Explain.]

Step 2 Add 0.1 to each of the non-smokers' household poverty ratio. [Answer this question: does the dataset at hand come from a null population or an alternative population? Explain.]

Step 3 Permute the dataset from Step 2 and run a two-sample permutation test with pseudo code as follows:

  repeat so as to do a permutation test:
  permute data
  find difference in mean poverty across two groups
  find difference in median poverty across two groups
  keep track of all the differences
  find a sampling distribution for permuted differences (both means and medians)
Step 4 Repeat steps 1-3 a bunch of times, measure how often the non-null dataset at hand crosses the threshold of significance. Which test is more powerful? [Use the empirical results to answer the question about power.]

Something like this may eventually come in handy:

# NHANES.ALT will be the alternative data on which the permutation test will be applied
NHANES.ALT = NHANES %>% select(Poverty, SmokeNow) %>% 
  filter(!is.na(SmokeNow)) %>% 
  mutate(PovertyPerm = sample(Poverty, replace=FALSE)) %>%
  mutate(PovertyPerm = PovertyPerm + ifelse(SmokeNow == "No", 0.1, 0))
Let the parameter $\pi_R$ represents the true p-value given by enumerating every single possible permuation (assume the data have already been collected, so the observed data is already given/fixed). For one permutation, the probability that the test will reject $H_0$ is $\pi_R$. Said differently, for each permutation, the result can be thought of as a Bernoulli random variable:
$$X_i = \left{ \begin{array}{ll} 1 & i^{th} \mbox{ perm stat} \geq \mbox{observed stat}\ 0 & i^{th} \mbox{ perm stat} < \mbox{observed stat} \end{array} \right. $$

Consider the case where a permutation test was run 1000 times and the empirical p-value was found to be 0.047. Give a confidence interval for the true randomization p-value which would have been calculated if the test was run on all possible permutations of the data.
